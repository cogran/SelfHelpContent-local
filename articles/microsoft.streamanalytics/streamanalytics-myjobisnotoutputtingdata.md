<properties 
    pageTitle="My job is not outputting data"
    description="作业不输出数据"
    service="microsoft.streamanalytics"
    resource="streamingjobs"
    authors="kschaefer13"
    displayOrder="1"
    selfHelpType="resource"
    supportTopicIds=""
    productPesIds=""
    cloudEnvironments="public"
/>


# <a name="my-job-is-not-outputting-data"></a>作业不输出数据

## <a name="recommended-steps"></a>**建议的步骤**
1. 使用每项输入和输出对应的“测试连接”按钮来验证与输入和输出的连接。 
2. 使用“服务总线资源管理器”连接到 Azure EventHub（如果使用了 EventHub 输入），验证输入数据是否流入 EventHub。 
3. 使用每项输入对应的“示例数据”按钮下载输入示例数据。 
4. 检查示例数据，了解数据的形式：架构和数据类型。 
5. 在“查询”选项卡中，使用“测试”按钮测试查询，并使用下载的示例数据测试查询。 检查并尝试修正所有错误。  
6. 如果使用了 Timestamp By，请确保事件中的时间戳大于作业开始时间。 
7. 使用步骤将查询从简单的 select 语句逐渐重新生成为更复杂的聚合。 使用 WITH 子句逐步生成查询逻辑。
8. 请注意一些常见的陷阱： <br>
    * 查询可能在正常运行，但是，举例来说，查询中的 where 子句筛选掉了查询事件，从而阻止生成输出。 <br>
    * 查询可能在正常运行，但由于时间范围过大，需要等待相应的持续时间才能看到查询的输出。 <br>
9. 如果所有这些步骤都可正常执行，请转到“设置”边栏选项卡并选择事件顺序。 确保此策略配置对作业起作用。 请注意，使用“测试”按钮测试查询时，不会应用此策略。 这是在浏览器中测试与实际运行作业之间的差别。 
10. 请启动作业，检查作业是否按预期运行。  
11. 一旦作业状态更改为“正在运行”，经过查询中指定的持续时间后，可以在接收器数据源中看到输出。 
12. 如果在经过预期的持续时间（基于查询）之后未获得任何输出，请尝试以下操作： <br>
    * 在“监视器”选项卡上查看“监视指标”。 此处的指标会延迟大约几分钟显示，因为它们是过去一分钟的聚合值。 <br>
    * 查看“输入事件数”、“运行时错误数”和“数据转换错误数”的指标。 <br>
        * 如果“输入事件数”大于 0，则 ASA 作业可以读取数据。 否则，可能表示存在问题 <br>
            * 使用服务总线资源管理器（如果将事件中心用作输入）查看数据源，确定它是否包含此作业的有效数据 <br>
            * 检查数据序列化格式和编码是否符合预期。 <br>
            * 如果使用事件中心，消息正文可能为 Null。 <br>
        * 如果“数据转换错误数”大于 0 且在不断增加，则表示： <br>
            * 作业可能无法反序列化事件。 <br>
            * 事件架构可能与查询中事件的已定义/预期架构不匹配。 <br>
            * 事件中某些字段的数据类型不符合预期。 <br>
        * 如果“运行时错误数”大于 0，则表示 ASA 作业可以接收数据，但处理查询时遇到错误。 请转到“操作日志”，筛选“失败”状态查找所有这些错误。 <br>
        * 如果“输入事件数”大于 0 且“输出事件数”等于 0，则表示： <br>
            * 查询处理导致生成零个输出事件。 <br>
            * 事件或其字段可能格式不当，因此导致完成查询处理后生成了零个输入。 <br>
            * 由于连接/身份验证方面的原因，无法将数据推送到输出接收器。 <br>
            * 如果发生所有这些错误，操作日志消息会解释其他详细信息（包括发生了什么情况），但如果查询逻辑筛选掉了所有事件，则不提供这些详细信息。 如果多个事件的处理生成了错误，流分析会在 10 分钟内将相同类型的前 3 条错误消息记录到操作日志，然后抑制其他相同的错误，同时显示一条消息“错误发生的速度过快，正在抑制这些错误”。 <br>

如果转到特定输出类型的输出不可见，请将输出重定向到不太复杂的其他输出类型（如 Azure Blob），然后检查是否可以在该处看到输出（使用存储资源管理器）。 

如果没有问题，则需要分析数据流。 可以在流分析作业的“设置”边栏选项卡中单击“作业关系图”按钮，使用能够直观显示作业的作业关系图对数据流进行系统性的分析。 对于现有作业，必须先重新启动该作业。 

在[此处](https://aka.ms/job_diagram)了解作业关系图。

在作业关系图中检查以下输入指标，帮助解答有关作业从其输入源获取数据的以下针对性问题。 如果查询已分区，请检查每个分区。  

**QueryLastProcessedTime** 此指标表示特定步骤收到数据的时间。 根据拓扑，回头调查输出处理器，判断哪个步骤未接收数据。 如果某个步骤未接收数据，请转到上一个查询步骤，检查它是否带有时间范围，以及它是否花费了足够的时间来输出数据（请注意该时间范围以小时计）。 

如果前一个步骤是输入处理器，请使用输入指标帮助解答有关作业从其输入源获取数据的以下针对性问题。 如果查询已分区，请检查每个分区。  

_1) 实际读取了多少数据？_ 

**InputEventsSourcesTotal** 指标提供已读取的数据单位数目，例如 Blob 数目。 <br>
**InputEventsTotal** 提供已读取的事件数目。 此指标按分区提供。 <br>
**InputEventsInBytesTotal** 提供已读取的字节数目。 <br>
**InputEventsLastArrivalTime 将连同每个已接收事件的排队时间一起更新。

_2) 时间是否在不断前进？如果已读取实际事件，可能不会发出停顿。_ 

**InputEventsLastPunctuationTime** 表示发出停顿、使时间不断前进的时间。 如果不发出停顿，数据流可能会阻塞。

_3) 输入中是否有任何错误？_ 

**InputEventsEventDataNullTotal** 保存包含 null 数据的事件计数。 <br>
**InputEventsSerializerErrorsTotal** 保存无法正确反序列化的事件计数。 <br>
**InputEventsDegradedTotal** 保存出现了问题、但该问题不是反序列化问题的事件计数。

_4) 是否正在丢弃/调整事件？_ 

**InputEventsEarlyTotal** 提供在前高水位线之前具有应用程序时间戳的事件数目。 <br>
**InputEventsLateTotal** 提供在前高水位线之后具有应用程序时间戳的事件数目。 <br>
**InputEventsDroppedBeforeApplicationStartTimeTotal** 提供在作业开始时间之前被丢弃的事件数目。

_5) 读取数据的时间是否有滞后？_ 

**InputEventsSourcesBackloggedTotal** 告知还需要为 EventHub 和 IoTHub 输入读取多少条消息。 <br>

_建立 Microsoft 支持案例_

如果仍然无法判断出问题所在，请转到操作日志，选择一个最新的条目，单击屏幕底部的“详细信息”按钮，然后复制该页面上的所有详细信息并将其提供给 Microsoft 支持部门。 

此外，如果可能，请包含示例数据，描述作业应该在相应的时间生成输出。


<!--HONumber=Nov16_HO1-->


